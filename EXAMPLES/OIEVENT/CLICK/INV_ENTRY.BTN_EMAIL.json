{
    "record1": {
        "<1>": "\r\n$Insert Mapi_Equates\r\n\r\nDeclare Function Unassigned, Set_Status, Get_Status\r\nDeclare Function MapiSendMail, MapiLogon, MapiLogoff, Msg\r\n\r\nequ CRLF$ to \\0D0A\\\r\nequ CR$   to \\0D\\\r\nequ LF$   to \\0A\\\r\nequ TAB$  to \\09\\\r\n\r\nTxt   = \"Below Find your Invoice Information\" \t: CRLF$\r\nTxt  := \"\"\t\t\t\t\t\t          \t\t: CRLF$\r\n\r\ndetails = .details->list\r\nid\t\t= .id->text\r\namount  = .amount->text\r\ncust_no = .cust_no->text\r\n\r\nemail_address = xlate('CUSTOMERS', Cust_no, 'EMAIL', 'X')\r\nif len(email_address) else\r\n\tx = msg('','There is no email address entered for customer number ':cust_no:'.|Please enter one and try this process again')\r\n\treturn 0\r\nEnd\r\n\r\ninv_date = .invoice_date->text\r\nconvert @vm to tab$ in details\r\nswap @fm with crlf$ in details\r\n\r\ntxt:= 'Invoice Number ':tab$:id:crlf$\r\ntxt:= 'Invoice Date\t':tab$: inv_date :crlf$\r\ntxt:= 'Invoice Amt\t':tab$: amount :crlf$\r\ntxt:= 'SKU':tab$:tab$:'Description': tab$:tab$:tab$:'Qty':tab$: 'Cost' :tab$:'Price':crlf$\r\ntxt:= details: CRLF$ \r\n\r\nFlags = MAPI_LOGON_UI$ \r\n\r\nMessage = ''\r\nMessage<POS_SUBJECT$> = \"Your Invoice\"\r\nMessage<POS_TO$     > = email_address\r\nMessage<POS_TEXT$   > = Txt\r\nMessage<POS_FLAGS$  > = Flags\r\nMessage<POS_TYPE$   > = \"IPM.Microsoft Mail.Note\"\r\n\r\nx = Set_Status(0)\r\ncheck = MAPILogon(session_id, parent, '', '', flags)\r\nif Get_Status(ErrCode) then\r\n\tCall FsMsg()\r\nend\r\n\r\nif check then\r\n\tFLAGS = ''\r\n\tFlags = MAPI_LOGON_UI$ + MAPI_DIALOG$\r\n\tif MAPISendMail(session_id, 0, Flags, Message) then\r\n\t\tx = Msg(@window, \"Message sent successfully!\")\r\n\tend else\r\n\t\tx = Get_Status(ErrMsg)\r\n\t\ty = 'No email was sent!'\r\n\t\tx = Msg(@window, y:' Reason: ':ErrMsg)\r\n\tend\r\n\r\nEnd else\r\n\tx = Get_Status(ErrMsg)\r\n\tx = Msg(@window, ErrMsg)\r\nEnd\r\n\r\nx = MapiLogoff(Session_id)\r\n\r\nreturn 0"
    }
}