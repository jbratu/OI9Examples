{
    "record1": {
        "<1>": "Declare Function Create_Dialog, Send_Event, Start_MDIChild, OpenNotesDB, OpenNote\r\nDeclare Function CloseNotesDB, Message_Box, GiveDirect\r\n\r\nDeclare Subroutine DeleteNote, End_Window, Send_Message, Utility\r\n\r\nEqu TRUE$  to 1\r\nEqu FALSE$ to 0\r\n\r\n$Insert Notes_Equates\r\n$Insert Message_Box_Equates\r\n\r\nmdi_win   = \"NM_MDI\"\r\ndlg_win   = \"NM_DIALOG\"\r\nprop_win  = \"FLD_PROP\" \r\nAppTitle  = \"Notes Manager\"\r\n\r\nchild_win = @mdi_win->mdiactive\r\n\r\nList1  = @window:\".list_1\"\r\ndel    = @fm\r\nserver = @user0<.combo_1->selpos>\r\n\r\nIf server = \"\" Then del = \"\"\r\n\r\nfilepath = @user2<.list_1->selpos>\t\t\r\ndbname   = server:del:filepath\r\n\t\t\r\n\r\nIf Param1 eq \"N\" Then\r\n\tnote_name = \"(untitled)\"\t\t\t\r\nEnd Else\r\n\tnote_name = .list_3->list<.list_3->selpos>\r\nEnd\r\n\r\n* Set current note\"s type.\r\n\r\nsrcstr = NOTE_CLASS_FORM$:@fm:NOTE_CLASS_VIEW$:@fm:NOTE_CLASS_FIELD$\r\n\r\nnote_type = field(srcstr, @fm, .axl_edl->text) \r\n\r\nBegin Case\r\n\tCase Message = \"REFRESH_DIRS\"\r\n\t\tIf .text_1->text Ne \"\" Then\r\n\t\t\t.text_1->text = \"\"\r\n\t\t\t.list_3->list = \"\"\r\n\t\t\t.okay->enabled = FALSE$\r\n\t\t\t.list_3->visible = TRUE$\r\n\t\t\t.text_3->text = \"\"\r\n\t\tEnd\r\n\t\t\r\n\t\tdirct  = @user4<.list_2->selpos>\r\n\t\tdbpath  = dirct\r\n\t\tserver = @user0<.combo_1->selpos>\r\n\t\t\r\n\t\tUtility(\"CURSOR\",\"H\")\r\n\t\t\r\n\t\tGoSub UpdateDirsInfo\r\n\r\n\t\tConvert @UPPER.CASE To @LOWER.CASE In dirct\t \r\n\t\tpos = count(dirct, \"\\\")\r\n\t\tIf dirct[-1, 1] = \".\" Then\t\t \r\n\t\t\toffs = Len(field(dirct, \"\\\", pos)) + 4\r\n\t\t\tdirct[-offs, offs] = \"\"  \r\n\t\tEnd\r\n\t\r\n\t\tLoop While Len(dirct) > 23 And pos Do\t  \r\n\t\t\tSwap \"\\...\\\" with \"\" in dirct   \r\n\t\t\tdirct[1, Len(field(dirct, \"\\\", 1))] = \"\\...\"\t      \t    \r\n   \t\tRepeat\r\n\t\t.text_2->text = dirct\r\n \r\n\t\tUtility(\"CURSOR\",\"A\") \r\n\t\t\r\n\t\r\n\tCase Message = \"CLEAN_DIRS\"\r\n        Convert @UPPER.CASE to @LOWER.CASE in @user2\r\n\r\n        .edit_btn->enabled = FALSE$ \r\n        .del_btn->enabled  = FALSE$\r\n        \r\n        .list_3->list = \"\"\r\n        .text_3->text = \"\"\r\n        .text_1->text = @user2<.list_1->selpos>[-1, \"B\\\"]\r\n        \r\n        iCnt = count(@List1->list, @fm) + 1\r\n        For i = 1 to iCnt\r\n\t        Send_Message( List1, \"UPDATE\", i, \"1-1\")\r\n        Next i\t\r\n\r\n        If .text_1->text Ne \"\" Then\r\n\t        .new_btn->enabled = TRUE$\r\n        End\r\n\r\n\t\t\r\n\tCase Message = \"DELETE\"\r\n\t\tIf .edit_btn->enabled Else return FALSE$\r\n\t\t\r\n\t\tansw = Message_Box(@window, \"Do you really want to\":MSG_NL$:\"delete '\":note_name:\"'?\", |\r\n\t\tAppTitle, MSG_BTN_YESNO$ + MSG_DEFAULT2$ + MSG_ICON_QUESTION$)\r\n\t\tIf answ Eq MSG_RET_NO$ Then Return 0\r\n\t\t\r\n\t\tUtility(\"CURSOR\",\"H\")\r\n\t\tDelList = .list_3->selpos\r\n\t\t\r\n\t\tIf OpenNotesDB(dbname) Then\r\n   \t\t\tIf OpenNote(dbname, \"LINEAR\":@fm:\"SELECT $Title = '\":note_name:\"'\":@fm:note_type, noteID) Then\r\n      \t\t\tDeleteNote(noteID)\r\n      \t\t\tiCnt = count(.list_3->list, @fm) + 1\r\n\t\t\r\n\t\t\t\tFor i = iCnt to 1 Step -1\t\r\n\t\t\t\t\tLocate i In DelList Using @fm Setting pos Then\t\r\n\t\t\t\t\t\tSend_Message(dlg_win:\".LIST_3\", \"DELETE\", i)\r\n\t\t\t\t\t\t.list_3->selpos = Not(i-1) + (i-1)\r\n\t\t\t\t\tEnd\t\r\n\t\t\t\tNext i\r\n\t    \tEnd \r\n\t\tEnd\r\n\t\tx = CloseNotesDB(dbname)\r\n\t\tUtility(\"CURSOR\",\"A\")\r\n\t\t\r\n\r\n\tCase Message = \"EDIT\"\r\n\t\tIf Not(.edit_btn->enabled) And (Param1 Ne \"N\") Then Return FALSE$\r\n\t\t\r\n\t\tcrParam = \"\"\r\n\t\tConvert @fm to @vm in dbname\r\n\t\tcrParam<1> = dbname\r\n\t\tcrParam<2> = note_name\r\n\t\t\r\n\t\tcrParam<3> = note_type\r\n\t\tIf note_name Ne \"(untitled)\" Then\r\n\t\t\tnote_title = .edit_btn->text[2,\"F\"]:\" \":note_name\r\n\t\tEnd Else\r\n\t\t\tnote_title = note_name\t\t\t\t\t\t\r\n\t\tEnd\t\t\t\r\n\t\t@recur0 += 1           \r\n\t\t\t\t\r\n\t\t/* Show the buttons on toolbar */\r\n\r\n\t\tCntrList = \".save_btn;.del_btn;.newf_btn;.news_btn;.newc_btn;.editc_btn;.riched_btn\"\r\n\t\tConvert \";\" to @rm in CntrList\r\n\t\tSwap \".\" with mdi_win:\".\" in CntrList\r\n\t\t\r\n\t\t@CntrList->visible = TRUE$\r\n\r\n\t\t/* Show a new child window */\r\n\t\tstatus = Start_MDIChild(\"EDITFRM\", mdi_win, crParam, @recur0, note_title, 1)  \t\t   \t\t\t\t\r\n\t\t\r\n\t\t\r\n\tCase Message = \"FILL_TABS\"\r\n\t\tDeclare Subroutine GiveFormView\r\n\t\t\r\n        If .text_1->text Eq \"\" Then Return FALSE$\r\n\r\n        PosSel = @List1->selpos\r\n        del = @fm\r\n        server = @user0<.combo_1->selpos>\r\n        If server = \"\" Then del = \"\"\r\n\r\n        filepath = @user2<.list_1->selpos>\t\t\r\n        dbname   = server:del:filepath\r\n        flg      = .axl_edl->text\r\n        If flg = 3 Then\r\n        \t.edit_btn->text = \"&Show\"\r\n\t\tEnd Else         \t\r\n        \t.edit_btn->text = \"&Edit\"\r\n\t\tEnd        \t\t\t\t\r\n\r\n        Utility(\"CURSOR\", \"H\")\r\n        \r\n\t    GiveFormView(dbname, buff, flg, retval)\t\t\t;* Show forms (views, shared fields)\r\n\r\n\t    If Not(Num(retval)) Then\r\n\t        answ = Message_Box(@window, retval, AppTitle, | \r\n\t        \t\t\t\t   MSG_BTN_OK$ + MSG_DEFAULT1$ + MSG_ICON_EXCLAM$)\t\t\t\t\t\t\t        \t\t\t\t\t   \r\n\t\tEnd Else\r\n\t\t\r\n\t\t\t/* Show all available forms, views or shared fields. */\r\n\t\t\t\r\n\t\t\t.list_3->forecolor = 255*Not(Not(retval))\r\n        \t.list_3->list = buff\r\n        \t\r\n        \t/* Change picture next to the selection */\r\n        \t\r\n\t\t    Send_Message(List1, \"UPDATE\", PosSel, \"2-1\")\r\n\t\tEnd        \t\r\n    \r\n\t\tUtility(\"CURSOR\", \"A\")\r\n\t\t\r\n\t\t\r\n\tCase Message = \"KEYBOARD_INPUT\"\t\r\n\t\tDeclare Function IsInList\r\n\r\n\t\tdbpath = .text_1->text\t\t\r\n\t\tConvert \" \" to \"\" in dbpath\r\n\t\t\r\n\t\tIf Len(dbpath) = 0 Then Return FALSE$\t;* dbase path has not been defined\r\n\t\t\r\n\t\t/* Assume that part of dbpath is a file name. */\r\n\t\tfile_name = dbpath[-1, \"B\\\"]\t\r\n\t\tIf IsInList(\".nsf\", file_name) Then\r\n\t\t\tadd_path = .edl_1->text\r\n\t\t\tdbpath = dbpath[1, Len(dbpath) - Len(file_name)]\r\n\t\t\tIf Len(dbpath) >= Len(add_path) Then\r\n\t\t\t\tsrc   = dbpath\r\n\t\t\t\ttempl = add_path\r\n\t\t\tEnd Else\r\n\t\t\t\tsrc   = add_path\r\n\t\t\t\ttempl = dbpath\t\r\n\t\t\tEnd\t\r\n\t\t\r\n\t\t\tIf Not(IsInList(templ, src)) Then\r\n\t\t\t\tdbpath := add_path\r\n\t\t\tEnd\t\r\n\t\tEnd Else\r\n\t\t\t/* Not a file. Add last back slash if necessary. */\r\n\t\t\tIf dbpath[-1, 1] Ne \"\\\" Then dbpath := \"\\\"\r\n\t\t\t.edl_1->text = dbpath\t\t\t\r\n\t\tEnd\r\n\t\t\r\n\t\tUtility(\"CURSOR\", \"H\")\r\n\t\t\r\n\t\tGoSub UpdateDirsInfo\r\n\t\t\r\n\t\tUtility(\"CURSOR\", \"A\")\r\n\t\t\r\n\t\tIf Len(file_name) Then\r\n\t\t\t.text_2->text = dbpath\r\n\t\t\tConvert @LOWER_CASE to @UPPER_CASE in file_name\r\n\t\t\t\r\n\t\t\tpos = Index(@user2, file_name, 1)\r\n\t\t\tIf Not(pos) Then Return FALSE$\r\n\t\t\t.list_1->selpos = count(@user2[1, pos], @fm) + 1\r\n\t\t\r\n\t\t\tdbname = server:@fm:dbpath:file_name\r\n\t\t\tstatus = Send_Event(dlg_win:\".LIST_1\", \"DBLCLK\")\r\n\t\tEnd \r\n\t\t\r\n\t\t\r\n\t\r\n\tCase Message = \"NEW\" \r\n        status = Send_Event(dlg_win, \"OMNIEVENT\", \"EDIT\", \"N\")   \r\n           \r\n\t\r\n\tCase Message = \"PRIVATE_PROPERTY\"\r\n\t\tBegin Case \r\n\t\t\tCase Param1 = \"L1GF\"\r\n\t\t\t\tIf .list_1->selpos Then\r\n\t\t\t\t\t.new_btn->enabled = TRUE$\r\n\t\t\t\tEnd\t\r\n\t\t\t\t\r\n\t\t\tCase Param1 = \"AXL_EDL_CNGD\"\r\n\t\t\t\t.edit_btn->enabled = FALSE$\r\n\t\t\t\t.del_btn->enabled  = FALSE$\r\n\t\t\t\tstatus = Send_Event(dlg_win, \"OMNIEVENT\", \"FILL_TABS\")   \r\n\t\t\t\t\r\n\t\t\tCase Param1 = \"L3_CNGD\"\r\n\t\t\t\t.text_3->text = .list_3->list<.list_3->selpos>\r\n\t\t\t\t\r\n\t\t\t\t/* Enable only when data exists */\r\n\t\t\t\tIf .list_3->forecolor Else \r\n\t\t\t\t\t.edit_btn->enabled = TRUE$\r\n\t\t\t\t\t.del_btn->enabled  = TRUE$ \t\t\t\t\r\n\t\t\t\tEnd\r\n\t\t\t\t\r\n\t\t\tCase Param1 = \"L3_LSTF\"\r\n\t\t\t\t.edit->enabled = 0\t\t\t\t\r\n\t\tEnd Case\t\t\t\r\n\t\t\r\n\t\t\r\n\tCase Message = \"SERVER_SELECT\"\r\n        GoSub DirListRefresh\r\n\t\t\r\nEnd Case\r\nRETURN 0\r\n\r\nDirListRefresh:\r\n\tIf .text_1->text Ne \"\" Then\r\n\t \t.text_1->text= \"\"\r\n\t  \t.list_3->list= \"\"\r\n\t  \t.text_3->text= \"\"\r\n\tEnd\r\n\tUtility(\"CURSOR\", \"H\")  \r\n\tRetval = GiveDirect(server, \"\", @user1, @user2, @user3, @user4, 1)\r\n\tIf Retval = 1 Then\r\n\t\t.list_1->list = @user1\r\n\t\t.list_2->list = @user3\r\n\tEnd Else\r\n\t\t.combo_1->selpos = @recur3\r\n\tEnd\r\n\r\n\tUtility(\"CURSOR\", \"A\")\r\nReturn\r\n\r\nUpdateDirsInfo:\r\n\tIf GiveDirect (server, dbpath, @user1, @user2, @user3, @user4, 1) > 0 Then\r\n        .list_1->list = @user1\r\n        .list_3->list = \"\"\r\n        \r\n\t\tIf @user3<1> = \"..\" Then\r\n\t\t\t@user3<1> = @user3<1>:@fm:\"2-1:\"\r\n\t\t\t@user3[1,3] = \"\"\r\n\t\t\t\r\n\t\t\tiCnt = count(@user3, @fm) + 1\r\n\t\t\tFor i = 2 to iCnt\r\n\t\t\t\t@user3<i> = \"1-2:\":@user3<i>\r\n\t\t\tNext\r\n\t\tEnd\r\n\t\t.list_2->list = @user3\r\n\tEnd  \r\nReturn\r\n"
    }
}