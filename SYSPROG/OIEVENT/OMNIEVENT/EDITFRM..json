{
    "record1": {
        "<1>": "Declare Function Create_Dialog, Send_Event, OpenNotesDB, OpenNote, ListNoteFields\r\nDeclare Function CloseNotesDB, IsInList\t\r\nDeclare Subroutine End_Window, Set_Property\r\n\r\n$Insert Notes_Equates\r\nEqu TRUE$  to 1\r\nEqu FALSE$ to 0\r\n\r\nmdi_win\t  = \"NM_MDI\"\r\ndlg_win\t  = \"NM_DIALOG\"\r\nchild_win = @mdi_win->mdiactive\r\n\r\nBegin Case\r\n\tCase Message = \"ACTIVATED\"\r\n\t\t/* Activate all menu items and buttons according to current note */\r\n\t\t\r\n        type_flg = Pwr(2, .text_3->text)\r\n\t\tdel_flg  = BitAnd(type_flg, 2) Or BitAnd(type_flg, 4) And Not(BitAnd(type_flg, 8))\r\n        save_flg = Get_Property(child_win:\".TEXT_4\", \"TEXT\")\r\n        \r\n        flags    = Not(save_flg):@fm:del_flg:@fm:BitAnd(type_flg, 2):@fm:BitAnd(type_flg, 4)\r\n        \r\n\t\tIf IsInList(\"(untitled)\", @child_win->text) Then\r\n\t\t\tflags<-1> = BitAnd(type_flg, 8)\r\n\t\tEnd Else\r\n\t\t\tflags<-1> = FALSE$\r\n\t\tEnd\t\t          \r\n\r\n        buttons    = \"save_btn;del_btn;newf_btn;newc_btn;news_btn\"\r\n        menu_items = \"FILE.SAVE;EDIT.DELETE;EDIT.FLD;EDIT.COL;EDIT.SH_FLD;CASCADE;TILE;ARNG\"\r\n        \r\n        Convert \";\" to @fm in buttons\r\n        Convert \";\" to @fm in menu_items\r\n        \r\n        iMnuCnt = Count(menu_items, @fm) + 1\r\n        nBttCnt = Count(buttons,    @fm) + 1\r\n\r\n        .prop_tbl->redraw = TRUE$\t\t\t\r\n        \r\n        For i = 1 to iMnuCnt\r\n        \tIf i <= nBttCnt Then\r\n        \t\tflg = flags<i>\r\n\t            Set_Property(mdi_win:\".\":buttons<i>, \"ENABLED\", flg)    \r\n\t\t\tEnd Else\r\n\t\t\t\tflg = TRUE$\r\n\t\t\tEnd\t\t\r\n            Set_Property(mdi_win:\".MENU.\":menu_items<i>, \"ENABLED\", flg)    \r\n        Next i\r\n\t\r\n\t\r\n\tCase Message = \"CHANGE_ITEM\"\r\n\t\t/* Reassign selected view column to selected field */\r\n\t\r\n\t\tpos      = .view_table->selpos<1> - 1\r\n\t\tItemName = .vf_list->list<.vf_list->selpos>\r\n\t\tvalue    = Set_Property(child_win:\".TABLE_2\", \"CELLPOS\", ItemName, 3:@fm:pos)\r\n\t\tvalue    = Set_Property(child_win:\".TABLE_2\", \"CELLPOS\", 0, 4:@fm:pos)\r\n\t\t\r\n\t\t.text_4->text = 0\r\n\r\n\t\tSet_Property(mdi_win:\".SAVE_BTN\", \t   \"ENABLED\", TRUE$) \t\t\t\r\n\t\tSet_Property(mdi_win:\".MENU.FILE.SAVE\", \"ENABLED\", TRUE$) \t\t\t\r\n\t\r\n\tCase Message = \"FILL_FIELDS\"\r\n\t\t/* Select all available fields and shared fields in the note */\r\n\t\t\r\n\t\tdbname = .text_1->text\r\n\t\tbuff = \"\"\r\n\t\t\r\n\t    If OpenNotesDB(dbname) Then\r\n\t    \tIf OpenNote(dbname, \"LINEAR\":@fm:\"@ALL\":@fm:NOTE_CLASS_FIELD$ + NOTE_CLASS_FORM$, noteID) Then\r\n\t    \t\tiCnt = count(noteID, @fm) + 1\r\n\t\t    \tFor i = 1 to iCnt\r\n\t\t  \t    \tstatus = ListNoteFields(noteID<i>, fields)\r\n\t  \t\t    \tconvert @vm to @svm in fields\r\n\t  \t    \t\tconvert @fm to @vm in fields\r\n\t  \t    \t\tbuff<i> = fields\r\n\t\t  \t    Next i\t\t\r\n\t  \t    \tConvert @vm to @fm in buff\r\n\t  \t    \tConvert @svm to @vm in buff\r\n\t\t\tEnd\r\n\t\t\tx = CloseNotesDB(dbname)\r\n\t\tEnd\r\n\t\t\r\n\t\tfields = \"\"\r\n\t\tiCnt = count(buff, @fm) + 1\t\t\r\n\t\tFor i = 1 to iCnt\r\n\t\t\tIf buff<i, 1>[1, 1] Ne \"$\" Then\r\n\t\t\t\tfields<-1> = buff<i, 1>\r\n\t\t\tEnd\r\n\t\tNext\t\t\r\n\t\t\r\n\t\t.vf_list->list = fields\t\t\r\n\t\tfields = .vf_list->list\r\n\t\tbuff = \"\"\r\n\t\tprev = \"\"\r\n\t\r\n\t\tiCnt = count(fields, @fm) + 1\r\n\t\tFor i = iCnt to 1 Step - 1\r\n\t\t\tIf prev Ne fields<i> Then \r\n\t\t\t\tbuff<-1> = fields<i>\r\n\t\t\t\tprev = fields<i>\r\n\t\t\tEnd\t\t\t\t\r\n\t\tNext i \r\n\t\t.vf_list->list = buff\r\n\t\t.temp->list = buff\r\n\t\t\r\n\t\t\r\n\tCase Message = \"FLASH\"\r\n\t\tDeclare Subroutine Send_Message\r\n\t\t\r\n\t\tListf = @window:\".fake_list\"\r\n\t\tb = 0\r\n\t\tSend_Message(Listf, \"INSERT\", 1, 1)\r\n\t\tFor i = 2 to 10\r\n\t\t\tSend_Message(Listf, \"UPDATE\", i - 1, \"2-1\") \t\r\n\t\t\ta =\tTime()\r\n\t\t\tc = 0\r\n\t\t\tLoop While (b - a < 1)\r\n\t\t\t\tc += 0.005\r\n\t\t\t\tb = Time() + c\r\n\t\t\tRepeat\t\t\r\n\t\t\tSend_Message(Listf, \"INSERT\", i, i)\r\n\t\tNext i\r\n\t\t@Listf->list = \"\"\r\n\t\t.view_table->list = \" \"\r\n\t\t\r\n\r\n\tCase Message = \"ITEM_ASSOCIATE\"\r\n\t\tpos \t = .view_table->selpos<1> - 1\r\n\t\tItemName = Get_Property(child_win:\".TABLE_2\", \"CELLPOS\", 3:@fm:pos)\r\n\t\t\r\n\t\tLocate ItemName In .temp->list Using @fm  Setting item_pos Then\r\n\t\t\t.vf_list->list = .temp->list\r\n\t\t\t.vf_list->selpos = item_pos\r\n\t\t\t.radio_1.Field->check = TRUE$\r\n\t\t\t.radio_1.Formula->check = FALSE$\r\n\t\tEnd Else\r\n\t\t\tbuf = Get_Property(child_win:\".TABLE_2\", \"CELLPOS\", 1:@fm:pos)\r\n\t\t\tSwap  \";\" with \";\":@fm in buf \r\n\t        .vf_list->list = buf\r\n   \t\t\t.radio_1.Field->check = FALSE$\r\n\t\t\t.radio_1.Formula->check = TRUE$\r\n\t\tEnd\t\r\n\t\t\r\n\t\t\t\r\n\tCase Message = \"PRIVATE_PROPERTY\"\r\n\t\tBegin Case\r\n\t\t\tCase Param1 = \"FLD_LIST_CNGD\"\r\n\t\t\t\tpos = .fld_list->selpos\r\n                For i = 1 to 2\r\n                    .prop_tbl->accesspos = 2:@fm:i\r\n\t\t\t\t    .prop_tbl->accessdata = .table_2->list<pos,i>\r\n                Next i\r\n\t\tEnd Case \t\t\t\r\n\r\n\t\t\r\n\tCase Message = \"SIZE\"\r\n\t\t/* To avoid a bug which kills authorized width and height after a form */\r\n\t\t/* was minimized and then restored back.\t\t\t\t\t\t\t   */\r\n\t\t\r\n\t\tcntrList = \";fld_list;right_lst;prop_tbl;view_table;vf_list;seprt\"\r\n\t\tSwap \";\" with @rm:@window:\".\" in cntrList\r\n\t\tcntrList[1, 1] = \"\"\r\n\t\t\r\n\t\tcntrSize = @cntrList->size\r\n\t\tConvert @fm to @vm in cntrSize\r\n\t\tConvert @rm to @fm in cntrSize\r\n\r\n    \twndSize  = .->size\r\n    \tl \t\t = wndSize<3> - 30 \r\n\t\tk \t\t = cntrSize<2, 3> / cntrSize<1, 3>\r\n\t\ttempSize = cntrSize<2>\r\n\t\t\r\n\t\tcntrSize<1, 3> = Int(l / (1 + k))\r\n\t\tcntrSize<1, 4> = wndSize<4> - cntrSize<1, 2> - 35\r\n\t\tcntrSize<2, 1> = Int(cntrSize<1, 1> + cntrSize<1, 3> + 7)\r\n\t\tcntrSize<2, 3> = Int(l * k / (1 + k))\r\n\t\tcntrSize<2, 4> = cntrSize<1, 4>\r\n\t\tcntrSize<3>    = cntrSize<2>\r\n\t\tcntrSize<4, 3> = wndSize<3> - cntrSize<4, 1> - 15\r\n\t\tcntrSize<5, 3> = wndSize<3> - cntrSize<5, 1> - 15\r\n\t\tcntrSize<5, 4> = wndSize<4> - cntrSize<5, 2> - 35\r\n\t\tcntrSize<6, 3> = cntrSize<5, 3>\r\n\t\t\r\n\t\tConvert @fm to @rm in cntrSize\r\n\t\tConvert @vm to @fm in cntrSize\r\n\t\t\r\n\t\t.->redraw = FALSE$\r\n\t\t\r\n\t\t@cntrList->size = cntrSize\r\n\t\t\r\n\t\t.->redraw = TRUE$\r\nEnd Case\r\nReturn FALSE$\r\n"
    }
}